"use strict";!function(a){var b=a.module("door3.css",[]);b.config(["$logProvider",function(a){a.debugEnabled(!1)}]),b.provider("$css",[function(){var b=this.defaults={element:"link",rel:"stylesheet",type:"text/css",container:"head",method:"append",weight:0};this.$get=["$rootScope","$exceptionHandler","$injector","$window","$timeout","$compile","$http","$filter","$log",function(d,e,f,g,h,i,j,k,l){function t(a,b,c){b&&("object"==typeof b.resolve?(d.$on(a+"ChangeSuccess",function(a,b,c){m.add(m.getFromRoute(b)),c&&m.remove(m.getFromRoute(c))}),d.$on(a+"ChangeError",function(a,b){var c=b.$$route.originalPath.replace(/(\s)/g,"");e(a.name+" on route:"+" '"+c+"'")})):(c&&m.remove(m.getFromRoute(c)),m.add(m.getFromRoute(b))))}function u(a,b,c){c&&b.hasOwnProperty("css")&&m.bind([x(b.css)],c)}function v(a,b,c){t("$route",b,c)}function w(a,b,c,d){t("$state",b,d)}function x(b){return b?(a.isString(b)&&(b=a.extend({href:b},r)),a.isArray(b)&&a.isString(b[0])&&a.forEach(b,function(c){b=a.extend({href:c},r)}),a.isObject(b)&&!a.isArray(b)&&(b=a.extend(b,r)),a.isArray(b)&&a.isObject(b[0])&&a.forEach(b,function(c){b=a.extend(c,r)}),b):void 0}function y(a){if(!a)return l.error("No stylesheets provided");var b="?cache=";-1===a.href.indexOf(b)&&(a.href=a.href+(a.bustCache?b+(new Date).getTime():""))}function z(a,b){return a&&b?k("filter")(a,function(a){return a[b]}):l.error("filterBy: missing array or property")}function A(a){return a?(o[a.href]=g.matchMedia(a.media),p[a.href]=function(b){h(function(){if(b.matches)d.stylesheets.push(a);else{var c=d.stylesheets.indexOf(k("filter")(d.stylesheets,{href:a.href})[0]);-1!==c&&d.stylesheets.splice(c,1)}})},o[a.href].addListener(p[a.href]),p[a.href](o[a.href]),void 0):l.error("No stylesheet provided")}function B(b){return b?(d&&a.isDefined(o)&&o[b.href]&&a.isDefined(p)&&o[b.href].removeListener(p[b.href]),void 0):l.error("No stylesheet provided")}function C(a){return a?!(!a.media||-1!==q.indexOf(a.media)||!g.matchMedia):l.error("No stylesheet provided")}var m={},n='<link ng-repeat="stylesheet in stylesheets track by $index | orderBy: \'weight\' " rel="{{ stylesheet.rel }}" type="{{ stylesheet.type }}" ng-href="{{ stylesheet.href }}" ng-attr-media="{{ stylesheet.media }}">',o={},p={},q=["print"],r=a.extend({},b),s=a.element(document.querySelector?document.querySelector(r.container):document.getElementsByTagName(r.container)[0]);return a.forEach(c,function(a,b){a.hasOwnProperty("css")&&(c[b]=x(a.css))}),d.stylesheets=[],s[r.method](i(n)(d)),d.$on("$directiveAdd",u),d.$on("$routeChangeStart",v),d.$on("$stateChangeStart",w),m.getFromRoute=function(b){if(!b)return l.error("Get From Route: No route provided");var c=null,d=[];return b.$$route&&b.$$route.css?c=b.$$route.css:b.css&&(c=b.css),c&&(a.isArray(c)?a.forEach(c,function(a){d.push(x(a))}):d.push(x(c))),d},m.getFromRoutes=function(b){if(!b)return l.error("Get From Routes: No routes provided");var c=[];return a.forEach(b,function(a){var b=m.getFromRoute(a);b.length&&c.push(b[0])}),c},m.getFromState=function(b){if(!b)return l.error("Get From State: No state provided");var c=[];return a.isDefined(b.views)&&a.forEach(b.views,function(a){a.css&&c.push(x(a.css))}),a.isDefined(b.children)&&a.forEach(b.children,function(b){b.css&&c.push(x(b.css)),a.isDefined(b.children)&&a.forEach(b.children,function(a){a.css&&c.push(x(a.css))})}),a.isDefined(b.css)&&(a.isArray(b.css)?a.forEach(b.css,function(a){c.push(x(a))}):c.push(x(b.css))),c},m.getFromStates=function(b){if(!b)return l.error("Get From States: No states provided");var c=[];return a.forEach(b,function(b){var d=m.getFromState(b);a.isArray(d)?a.forEach(d,function(a){c.push(a)}):c.push(d)}),c},m.preload=function(b,d){b||(b=[],c.length&&Array.prototype.push.apply(b,c),f.has("$route")&&Array.prototype.push.apply(b,m.getFromRoutes(f.get("$route").routes)),f.has("$state")&&Array.prototype.push.apply(b,m.getFromStates(f.get("$state").get()))),b=z(b,"preload"),a.forEach(b,function(c,e){j.get(c.href).success(function(c){l.debug("preload response: "+c),b.length===e+1&&a.isFunction(d)&&d(b)}).error(function(){l.error("Incorrect path for "+c.href)})})},m.bind=function(b,c){if(!b||!c)return l.error("No scope or stylesheets provided");var d=[];a.isArray(b)?a.forEach(b,function(a){d.push(x(a))}):d.push(x(b)),m.add(d),l.debug("$css.bind(): Added",d),c.$on("$destroy",function(){m.remove(d),l.debug("$css.bind(): Removed",d)})},m.add=function(b){return b?(a.isArray(b)||(b=[b]),a.forEach(b,function(a){a=x(a),a.href&&!k("filter")(d.stylesheets,{href:a.href}).length&&(y(a),C(a)?A(a):d.stylesheets.push(a),l.debug("$css.add(): "+a.href))}),d.$broadcast("$cssAdd",b,d.stylesheets),void 0):l.error("No stylesheets provided")},m.remove=function(b){return b?(a.isArray(b)||(b=[b]),b=k("filter")(b,function(a){return!a.persist}),a.forEach(b,function(a){a=x(a);var b=d.stylesheets.indexOf(k("filter")(d.stylesheets,{href:a.href})[0]);-1!==b&&d.stylesheets.splice(b,1),B(a),l.debug("$css.remove(): "+a.href)}),d.$broadcast("$cssRemove",b,d.stylesheets),void 0):l.error("No stylesheets provided")},m.removeAll=function(){d&&d.hasOwnProperty("stylesheets")&&(d.stylesheets.length=0),l.debug("all stylesheets removed")},m.preload(),m}]}]),b.filter("$cssLinks",function(){return function(b){if(!b||!a.isArray(b))return b;var c="";return a.forEach(b,function(a){c+='<link rel="'+a.rel+'" type="'+a.type+'" href="'+a.href+'"',c+=a.media?' media="'+a.media+'"':"",c+=">\n\n"}),c}}),b.run(["$css",function(){}]);var c=[],d=a.module;a.module=function(){var b=d.apply(this,arguments),e=b.directive;return b.directive=function(b,d){var f=a.isFunction(d)?d:d[d.length-1];try{var g=a.copy(f)();g.directiveName=b,g.hasOwnProperty("css")&&c.push(g)}catch(h){}return e.apply(this,arguments)},b.config(["$provide","$injector",function(b,d){a.forEach(c,function(a){var c=a.directiveName+"Directive";d.has(c)&&b.decorator(c,["$delegate","$rootScope","$timeout",function(b,c,d){var e=b[0],f=e.compile;return e.css&&(a.css=e.css),e.compile=function(){var a=f?f.apply(this,arguments):!1;return function(b){var f=arguments;d(function(){a&&a.apply(this,f)}),c.$broadcast("$directiveAdd",e,b)}},b}])})}]),b}}(angular);
