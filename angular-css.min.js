"use strict";!function(e){var r=e.module("door3.css",[]);r.config(["$logProvider",function(e){e.debugEnabled(!1)}]),r.provider("$css",[function(){var r=this.defaults={element:"link",rel:"stylesheet",type:"text/css",container:"head",method:"append",weight:0};this.$get=["$rootScope","$injector","$window","$timeout","$compile","$http","$filter","$log","$q",function(s,o,n,i,c,u,a,f,d){function h(e,r,t){t&&r.hasOwnProperty("css")&&S.bind([y(r.css)],t)}function l(e,r,t){var s,n,i;"_door3CssState"===t?(i=S.getFromState(e,"resolve"),n=o.get("$resolve")):(i=S.getFromRoute(e,"resolve"),s=e),r?e&&(s?(s.resolve||(s.resolve={}),s.resolve[t]=function(){var e=d.defer();return S.preload(i,function(){S.add(i)},"resolve",e),e.promise}):n.resolve({_door3CssState:function(){var e=d.defer();return S.preload(i,function(){S.add(i)},"resolve",e),e.promise}})):S.add(i)}function p(e,r,t){t&&S.remove(S.getFromRoute(t)),l(r,t,"_door3CssRoute")}function v(e,r,t,s){s&&S.remove(S.getFromState(s)),l(r,s,"_door3CssState")}function y(r){return r?(e.isString(r)&&(r=e.extend({href:r},x)),e.isArray(r)&&e.isString(r[0])&&e.forEach(r,function(t){r=e.extend({href:t},x)}),e.isObject(r)&&!e.isArray(r)&&(r=e.extend(r,x)),e.isArray(r)&&e.isObject(r[0])&&e.forEach(r,function(t){r=e.extend(t,x)}),r):void 0}function m(e){if(!e)return f.error("No stylesheets provided");var r="?cache=";-1===e.href.indexOf(r)&&(e.href=e.href+(e.bustCache?r+(new Date).getTime():""))}function g(e,r){return e&&r?a("filter")(e,function(e){return e[r]}):f.error("filterBy: missing array or property")}function $(e){return e?(F[e.href]=n.matchMedia(e.media),N[e.href]=function(r){i(function(){if(r.matches)s.stylesheets.push(e);else{var t=s.stylesheets.indexOf(a("filter")(s.stylesheets,{href:e.href})[0]);-1!==t&&s.stylesheets.splice(t,1)}})},F[e.href].addListener(N[e.href]),void N[e.href](F[e.href])):f.error("No stylesheet provided")}function b(r){return r?void(s&&e.isDefined(F)&&F[r.href]&&e.isDefined(N)&&F[r.href].removeListener(N[r.href])):f.error("No stylesheet provided")}function E(e){return e?!(!e.media||-1!==w.indexOf(e.media)||!n.matchMedia):f.error("No stylesheet provided")}var S={},A='<link ng-repeat="stylesheet in stylesheets track by $index | orderBy: \'weight\' " rel="{{ stylesheet.rel }}" type="{{ stylesheet.type }}" ng-href="{{ stylesheet.href }}" ng-attr-media="{{ stylesheet.media }}">',F={},N={},w=["print"],x=e.extend({},r),R=e.element(document.querySelector?document.querySelector(x.container):document.getElementsByTagName(x.container)[0]);return e.forEach(t,function(e,r){e.hasOwnProperty("css")&&(t[r]=y(e.css))}),s.stylesheets=[],R[x.method](c(A)(s)),s.$on("$directiveAdd",h),s.$on("$routeChangeStart",p),s.$on("$stateChangeStart",v),S.getFromRoute=function(r,t){var s;if(!r)return f.error("Get From Route: No route provided");var o=null,n=[];return r.$$route&&r.$$route.css?o=r.$$route.css:r.css&&(o=r.css),o&&(e.isArray(o)?e.forEach(o,function(e){e=y(e),t&&(e.resolve=!0),n.push(e)}):(s=y(o),t&&(s.resolve=!0),n.push(s))),n},S.getFromRoutes=function(r){if(!r)return f.error("Get From Routes: No routes provided");var t=[];return e.forEach(r,function(e){var r=S.getFromRoute(e);r.length&&t.push(r[0])}),t},S.getFromState=function(r,t){var s;if(!r)return f.error("Get From State: No state provided");var o=[];return e.isDefined(r.views)&&e.forEach(r.views,function(e){e.css&&(s=y(e.css),t&&(s.resolve=!0),o.push(s))}),e.isDefined(r.children)&&e.forEach(r.children,function(r){r.css&&(s=y(r.css),t&&(s.resolve=!0),o.push(s)),e.isDefined(r.children)&&e.forEach(r.children,function(e){e.css&&o.push(y(e.css))})}),e.isDefined(r.css)&&(e.isArray(r.css)?e.forEach(r.css,function(e){s=y(e),t&&(s.resolve=!0),o.push(y(e))}):o.push(y(r.css))),o},S.getFromStates=function(r){if(!r)return f.error("Get From States: No states provided");var t=[];return e.forEach(r,function(r){var s=S.getFromState(r);e.isArray(s)?e.forEach(s,function(e){t.push(e)}):t.push(s)}),t},S.preload=function(r,s,n,i){var c;"resolve"===n?c=!0:n="preload",r||(r=[],t.length&&Array.prototype.push.apply(r,t),o.has("$route")&&Array.prototype.push.apply(r,S.getFromRoutes(o.get("$route").routes)),o.has("$state")&&Array.prototype.push.apply(r,S.getFromStates(o.get("$state").get()))),r=g(r,n),e.forEach(r,function(t,o){u.get(t.href).success(function(t){f.debug("preload response: "+t),r.length===o+1&&e.isFunction(s)&&s(r)}).error(function(){f.error("Incorrect path for "+t.href),c&&i.reject()})}),c&&setTimeout(function(){i.resolve(!0)},1e3)},S.bind=function(r,t){if(!r||!t)return f.error("No scope or stylesheets provided");var s=[];e.isArray(r)?e.forEach(r,function(e){s.push(y(e))}):s.push(y(r)),S.add(s),f.debug("$css.bind(): Added",s),t.$on("$destroy",function(){S.remove(s),f.debug("$css.bind(): Removed",s)})},S.add=function(r){return r?(e.isArray(r)||(r=[r]),e.forEach(r,function(e){e=y(e),e.href&&!a("filter")(s.stylesheets,{href:e.href}).length&&(m(e),E(e)?$(e):s.stylesheets.push(e),f.debug("$css.add(): "+e.href))}),void s.$broadcast("$cssAdd",r,s.stylesheets)):f.error("No stylesheets provided")},S.remove=function(r){return r?(e.isArray(r)||(r=[r]),r=a("filter")(r,function(e){return!e.persist}),e.forEach(r,function(e){e=y(e);var r=s.stylesheets.indexOf(a("filter")(s.stylesheets,{href:e.href})[0]);-1!==r&&s.stylesheets.splice(r,1),b(e),f.debug("$css.remove(): "+e.href)}),void s.$broadcast("$cssRemove",r,s.stylesheets)):f.error("No stylesheets provided")},S.removeAll=function(){s&&s.hasOwnProperty("stylesheets")&&(s.stylesheets.length=0),f.debug("all stylesheets removed")},S.preload(),S}]}]),r.filter("$cssLinks",function(){return function(r){if(!r||!e.isArray(r))return r;var t="";return e.forEach(r,function(e){t+='<link rel="'+e.rel+'" type="'+e.type+'" href="'+e.href+'"',t+=e.media?' media="'+e.media+'"':"",t+=">\n\n"}),t}}),r.run(["$css",function(){}]);var t=[],s=e.module;e.module=function(){var r=s.apply(this,arguments),o=r.directive;return r.directive=function(r,s){var n=e.isFunction(s)?s:s[s.length-1];try{var i=e.copy(n)();i.directiveName=r,i.hasOwnProperty("css")&&t.push(i)}catch(c){}return o.apply(this,arguments)},r.config(["$provide","$injector",function(r,s){e.forEach(t,function(e){var t=e.directiveName+"Directive";s.has(t)&&r.decorator(t,["$delegate","$rootScope","$timeout",function(r,t,s){var o=r[0],n=o.compile;return o.css&&(e.css=o.css),o.compile=function(){var e=n?n.apply(this,arguments):!1;return function(r){var n=arguments;s(function(){e&&e.apply(this,n)}),t.$broadcast("$directiveAdd",o,r)}},r}])})}]),r}}(angular);
